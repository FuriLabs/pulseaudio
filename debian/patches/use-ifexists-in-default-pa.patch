Use .ifexists meta command to load optional modules only if available

From: CJ van den Berg <cj@vdbonline.com>


---

 src/daemon/default.pa.in |   16 ++++++++++++++--
 1 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/src/daemon/default.pa.in b/src/daemon/default.pa.in
index 0312266..aa36375 100755
--- a/src/daemon/default.pa.in
+++ b/src/daemon/default.pa.in
@@ -26,12 +26,18 @@
 #load-module module-null-sink
 #load-module module-pipe-sink
 
+.ifexists /usr/lib/pulse-0.9/modules/module-hal-detect.so
+
 ### Automatically load driver modules depending on the hardware available
 load-module module-hal-detect
 
+.else
+
 ### Alternatively use the static hardware detection module (for systems that
 ### lack HAL support
-#load-module module-detect
+load-module module-detect
+
+.endif
 
 ### Load audio drivers automatically on access
 #add-autoload-sink output module-oss device="/dev/dsp" sink_name=output source_name=input
@@ -41,8 +47,14 @@ load-module module-hal-detect
 #add-autoload-sink output module-alsa-sink sink_name=output
 #add-autoload-source input module-alsa-source source_name=input
 
-### Load several protocols
+.ifexists /usr/lib/pulse-0.9/modules/module-esound-protocol-unix.so
+
+### Load esound protocol
 load-module module-esound-protocol-unix
+
+.endif
+
+### Load native protocol
 load-module module-native-protocol-unix
 
 ### Network access (may be configured with paprefs, so leave this commented
